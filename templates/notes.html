<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DevNotes Frontend</title>
  <style>
    body {
      font-family: "Inter", system-ui, sans-serif;
      background: #f5f7fb;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1 { margin-top: 20px; color: #333; }

    /* Status Panel */
    #statusPanel {
      margin: 15px 0;
      background: #fff;
      padding: 12px 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      width: 90%;
      max-width: 500px;
      font-size: 14px;
    }

    /* Form */
    form {
      margin: 15px 0;
      background: white;
      padding: 20px 25px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      width: 90%;
      max-width: 500px;
    }

    input[type="text"] {
      flex: 1 1 45%;
      padding: 10px 14px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      outline: none;
      transition: border 0.2s;
    }
    input[type="text"]:focus { border-color: #007bff; }

    button {
      background: #007bff;
      color: white;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      flex: 1 1 100%;
    }
    button:hover { background: #005fcc; }

    /* Notes */
    #notesContainer {
      width: 90%;
      max-width: 600px;
      margin-bottom: 40px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .note {
      background: white;
      padding: 16px 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .note:hover { transform: translateY(-2px); }

    .note h3 { margin: 0 0 6px; color: #222; }
    .note p { margin: 0; color: #555; font-size: 14px; }

    .note button {
      flex: 0 0 auto;
      margin-left: 10px;
      padding: 4px 8px;
      font-size: 12px;
    }

    /* Spinner */
    #loading { display: none; margin-bottom: 10px; }

    /* Responsive */
    @media (max-width: 500px) {
      form { flex-direction: column; }
      input[type="text"] { flex: 1 1 100%; }
      .note { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <h1>My Notes</h1>

  <div id="statusPanel">
    <p>Environment: <span id="env">loading...</span></p>
    <p>Notes count: <span id="count">0</span></p>
    <p>Last fetch time: <span id="time">0</span> ms</p>
  </div>

  <div id="loading">Fetching notes...</div>

  <form id="noteForm">
    <input type="text" id="title" placeholder="Title" required />
    <input type="text" id="content" placeholder="Content" />
    <button type="submit">Add Note</button>
    <div id="notesContainer"></div>
    <button id="loadMore">Load More</button>
  </form>


  <script>
    let offset = 0;
    const limit = 5;

    async function fetchStatus() {
      const start = performance.now();
      const res = await fetch(`/status?offset=${offset}&limit=${limit}`);
      const data = await res.json();
      document.getElementById("env").textContent = data.env;
      document.getElementById("count").textContent = data.total_notes;
      document.getElementById("time").textContent = Math.round(performance.now() - start);
      return data.notes;
    }

    async function loadNotes(reset = true) {
      document.getElementById("loading").style.display = "block";
      const notes = await fetchStatus();
      const container = document.getElementById("notesContainer");
      if (reset) container.innerHTML = "";
      notes.forEach(note => {
        container.innerHTML += `
          <div class='note'>
            <div>
              <h3>${note.title}</h3>
              <p>${note.content || ''}</p>
            </div>
            <div>
              <button onclick="deleteNote(${note.id})">Delete</button>
              <button onclick="editNote(${note.id}, '${note.title}', '${note.content || ''}')">Edit</button>
            </div>
          </div>`;
      });
      document.getElementById("loading").style.display = "none";
    }

    async function deleteNote(id) {
      await fetch(`/notes/${id}`, { method: 'DELETE' });
      loadNotes();
    }

    function editNote(id, oldTitle, oldContent) {
      const title = prompt("Edit title:", oldTitle);
      const content = prompt("Edit content:", oldContent);
      if (title !== null) {
        fetch(`/notes/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, content })
        }).then(loadNotes);
      }
    }

    document.getElementById("noteForm").addEventListener("submit", async e => {
      e.preventDefault();
      const title = document.getElementById("title").value.trim();
      const content = document.getElementById("content").value.trim();
      if (!title) return alert("Title required!");
      await fetch("/notes/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, content })
      });
      document.getElementById("noteForm").reset();
      loadNotes();
    });

    document.getElementById("loadMore").addEventListener("click", () => {
      offset += limit;
      loadNotes(false);
    });

    // Initial load
    loadNotes();
  </script>
</body>
</html>

